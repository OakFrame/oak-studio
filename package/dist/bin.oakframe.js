!function(t){var s={};function i(e){if(s[e])return s[e].exports;var h=s[e]={i:e,l:!1,exports:{}};return t[e].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var h in t)i.d(e,h,function(s){return t[s]}.bind(null,h));return e},i.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.p="",i(i.s=0)}([function(t,s,i){"use strict";i.r(s),i.d(s,"Oak",(function(){return u}));class e{constructor(){this.x=0,this.y=0}clear(){return this.x=0,this.y=0,this}set(t,s){return this.x=t,this.y=s,this}add(t){return this.x+=t.x,this.y+=t.y,this}addI(t,s){return this.x+=t,this.y+=s,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subI(t,s){return this.x-=t,this.y-=s,this}mul(t){return this.x*=t.x,this.y*=t.y,this}mulI(t){return this.x*=t,this.y*=t,this}divI(t){return this.x/=t,this.y/=t,this}pointTo(t){return this.sub(t).normalize(),this}div(t){return this.x/=t.x,this.y/=t.y,this}rotate(t){return t*=Math.PI/180,this.set(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t)),this}toDeg(){let t=this.clone().normalize();return(Math.atan2(t.x,t.y+1e-7)/Math.PI*180+180)%360}toRad(){let t=this.clone().normalize();return Math.atan2(t.x,t.y+1e-7)}normalize(){let t=this.mag();return this.x/=t,this.y/=t,this}random(){return this.x=Math.random(),this.y=Math.random(),this}flipY(){return this.y*=-1,this}flipX(){return this.x*=-1,this}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}dot(t){return this.x*t.x+this.y*t.y}clone(){return(new e).set(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}dist(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}distEuclid(t,s){return Math.sqrt(Math.pow(this.x-t,2)+Math.pow(this.y-s,2))}toArray(){return[this.x,this.y]}fromArray(t){this.x=t[0],this.y=t[1]}toString(){return JSON.stringify(this)}}class h{constructor(){return this.x=0,this.y=0,this.z=0,this}clear(){return this.x=0,this.y=0,this.z=0,this}set(t,s,i){return this.x=t,this.y=s,this.z=i,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}mul(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}div(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}mulI(t){return this.x*=t,this.y*=t,this.z*=t,this}divI(t){return this.x/=t,this.y/=t,this.z/=t,this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}rotX(t){return r.y=this.y*Math.cos(t)-this.z*Math.sin(t),r.z=this.y*Math.sin(t)+this.z*Math.cos(t),this.y=r.y,this.z=r.z,this}rotY(t){return r.x=this.x*Math.cos(t)-this.z*Math.sin(t),r.z=this.x*Math.sin(t)+this.z*Math.cos(t),this.x=r.x,this.z=r.z,this}rotZ(t){return t*=Math.PI/180,r.x=this.x*Math.cos(t)-this.y*Math.sin(t),r.y=this.x*Math.sin(t)+this.y*Math.cos(t),this.x=r.x,this.y=r.y,this}flipX(){return this.x*=-1,this}flipY(){return this.y*=-1,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}pointTo(t){return this.sub(t).invert().normalize(),this}dist(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y)+(this.z-t.z)*(this.z-t.z))}mag(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){return o=this.mag(),this.x/=o,this.y/=o,this.z/=o,this}clone(){return(new h).set(this.x,this.y,this.z)}invert(){return this.x*=-1,this.y*=-1,this.z*=-1,this}toArray(){return[this.x,this.y,this.z]}toString(){return JSON.stringify(this)}static fromValues(t,s,i){return(new h).set(t,s,i)}}let o=0,r=new h;class n{constructor(t){this.src=[],this.images=[],t&&(this.src=Array.isArray(t)?t:[t]),this.listeners=[],this.ready=!1}getImage(){this.image_index=Date.now()/250|0,this.image_index=this.image_index%this.src.length;let t=this.images[this.image_index];if(!t){let t=new Image;return t.src=this.src[this.image_index],t.isReady=!1,t.onload=()=>{t.isReady=!0},this.images.push(t),null}return t||null}toString(){return JSON.stringify({src:this.src})}publish(t,s){this.listeners[t]&&this.listeners[t].forEach(t=>{t(s)})}on(t,s){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(s)}}class a{constructor(t,s){this.map=[],this.width=t,this.height=s;for(let i=0;i<t*s;i++)this.map[i]=0}add(t){for(let s=0;s<t.getMap().length;s++)this.map[s]+=t.map[s]}getMap(){return this.map}getDimensionalMap(){let t=[];for(let s=0;s<this.height;s++)t.push(this.map.slice(this.width*s,this.width*(s+1)));return t}run(t){let s=this,i=new a(this.width,this.height);return this.map.forEach((function(e,h){let o=h%s.width,r=h/s.width|0;i.map[h]=t(e,o,r)})),this.map=i.map,this}regionContains(t,s,i,e,h){let o=0,r=0;for(let n=i;n<=h;n++)for(let i=s;i<=e;i++)r++,this.getPosition(i,n)==t&&o++;return o/r}setMap(t){return this.map=t,this}setPosition(t,s,i){return t=(t+1e6*this.width)%this.width,s=(s+1e6*this.height)%this.height,this.map[(0|t)+(0|s)*this.width]=i,this}getPosition(t,s){return t=(t+1e6*this.width)%this.width,s=(s+1e6*this.height)%this.height,this.map[(0|t)+(0|s)*this.width]}overlay(t){let s=this;return t.getMap().forEach((function(t,i){t&&(s.map[i]=t)})),this}growClusters(t,s,i,e){let h=e||function(t,s,i){return!0},o=new a(this.width,this.height);for(let e=0;e<this.height;e++)for(let r=0;r<this.width;r++)this.regionContains(t,r-s,e-s,r+s,e+s)&&Math.random()<i&&h(this.getPosition(r,e),r,e)&&o.setPosition(r,e,t);this.overlay(o)}getWidth(){return this.width}getHeight(){return this.height}replace(t,s){let i=this;this.map.forEach((function(e,h){e==t&&(i.map[h]=s)}))}renderHTML(t){t||(t={attr:""});let s="";return s+=`<table ${t.attr||""}>`,this.getDimensionalMap().forEach((function(t){s+="<tr>",t.forEach((function(t){let i=[255,255,255];switch(isNaN(t)||(i=[255-255*t|0,255-255*t|0,255-255*t|0]),(t+"").toLowerCase()){case"f":i=[254,214,255];break;case"r":i=[160,160,160];break;case"t":i=[109,175,99];break;case"d":i=[247,240,203];break;case"w":i=[217,246,255];break;default:i=[209,235,169]}s+=`<td style='background-color:rgb(${i.join(",")})'>`,s+=t,s+="</td>"})),s+="</tr>"})),s+="</table>",s}walkLine(t,s,i,h,o){let r=(new e).set(t,s),n=(new e).set(i,h),a=r.pointTo(n).mulI(-1).toRad(),p=r.set(t,s).dist(n);console.log("line",t,s,i,h,r.set(t,s).dist(n)),console.log("dist",p),console.log("dir",a);for(let i=1;i<p;i+=.5){let e=t+Math.sin(a)*i|0,h=s+Math.cos(a)*i|0;this.setPosition(e,h,o)}}placeCluster(t,s,i,e,h){let o=t,r=s;for(let t=o;t<o+i;t+=1)for(let s=r;s<r+e;s+=1){let i=(t+this.width)%this.width,e=(s+this.height)%this.height;this.setPosition(i,e,h),console.log(i,e)}}normalize(){let t=-1e9;this.map.forEach((function(s){t=Math.max(t,s)}));for(let s=0;s<this.map.length;s++)this.map[s]/=t}multiply2(t){let s=this.getDimensionalMap();t=t.getDimensionalMap();for(var i=s.length,e=s[0].length,h=(t.length,t[0].length),o=new Array(i),r=0;r<i;++r){o[r]=new Array(h);for(var n=0;n<h;++n){o[r][n]=0;for(var a=0;a<e;++a)o[r][n]+=this.map[r][a]*t[a][n]}}this.map=o}multiply3(t){let s=this.getDimensionalMap();t=t.getDimensionalMap(),console.log(s,t);for(var i=[],e=0;e<s.length;e++){i[e]=[];for(var h=0;h<t[0].length;h++){for(var o=0,r=0;r<s[0].length;r++)o+=s[e][r]*t[r][h];i[e][h]=o}}this.map=i}multiply4(t){let s=[];this.getDimensionalMap(),t.getDimensionalMap();for(let i=0;i<this.getWidth();i++){s[i]=[];for(let e=0;e<t.getHeight();e++){s[i][e]=0;for(let h=0;h<this.getHeight();h++)s[i][e]+=this.getPosition(i,h)*t.getPosition(h,e)}}for(let s=0;s<this.getWidth();s++)for(let s=0;s<t.getHeight();s++);console.log("a",s);let i=[];s.forEach((function(t){i=i.concat(t)})),this.map=i}multiply(t){let s=this,i=s.getWidth(),e=s.getHeight(),h=new a(this.getWidth(),this.getHeight());for(let o=0;o<i;o++)for(let r=0;r<e;r++){let n=(o+1)/i*s.getWidth(),a=(r+1)/e*s.getHeight(),p=s.getPosition(n,a),c=(o+1)/i*t.getWidth(),m=(r+1)/e*t.getHeight(),l=t.getPosition(c,m);h.setPosition(o,r,p*l)}this.width=i,this.height=e,this.map=h.getMap()}}class p{constructor(){this.r=0,this.g=0,this.b=0,this.set=(t,s,i)=>(this.r=0|t,this.g=0|s,this.b=0|i,this),this.copy=t=>(this.r=t.r,this.g=t.g,this.b=t.b,this),this.toHex=()=>"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1),this.fromHex=t=>(t=t.replace("#",""),this.r=parseInt(t.substring(0,2),16),this.g=parseInt(t.substring(2,4),16),this.b=parseInt(t.substring(4,6),16),this)}}class c{constructor(){this.spriteCache=[],this.queued=0,this.loaded=0}loadSprite(t,s=!0){this.queued++;let i=new n(t);return this.spriteCache[t]=i,i.on("ready",()=>{this.loaded++,this.loaded>=this.queued&&this.publish("loaded",!0)}),s&&i.getImage(),i}getSpriteFromCache(t){return this.spriteCache[t]}static loadFile(t,s){var i=new XMLHttpRequest;i._loaded=!1,i.onreadystatechange=function(){i._loaded||4!==i.readyState||200!==i.status&&!i.responseText||(s(i.responseText),i._loaded=!0)},i.open("GET",t,!0),i.send()}publish(t,s){return null}}class m{constructor(){this._set=!1,this.d=new h,this.u=new h,this.v=new h,this.mm=0,this.p=new h,this.s=new e,this.tfov=1,this.tfovpower=1,this.tfovpoweraspect=1}set(t){this._set=!0,this.d.copy(t.to).sub(t.from),this.mm=Math.sqrt(this.d.x*this.d.x+this.d.y*this.d.y+this.d.z*this.d.z),this.d.divI(this.mm),this.u.copy(t.up),this.mm=this.u.dot(this.d),this.u.x-=this.mm*this.d.x,this.u.y-=this.mm*this.d.y,this.u.z-=this.mm*this.d.z,this.mm=Math.sqrt(this.u.x*this.u.x+this.u.y*this.u.y+this.u.z*this.u.z),this.u.divI(this.mm),this.tfov=Math.tan(t.fov*Math.PI/360),this.tfovpower=this.tfov*this.tfov,this.tfovpoweraspect=t.aspect*this.tfov*(t.aspect*this.tfov),this.u.mulI(this.tfov),this.v.set(this.u.y*this.d.z-this.d.y*this.u.z,this.u.z*this.d.x-this.d.z*this.u.x,this.u.x*this.d.y-this.d.x*this.u.y).mulI(t.aspect)}toWorld(t,s,i,e){this._set||(console.error("Projection has not been set from Camera source"),this._set=!0),this.s.x=2*s.x/t.getWidth()-1,this.s.y=1-2*s.y/t.getHeight(),this.p.x=this.d.x+this.u.x*this.s.y+this.v.x*this.s.x,this.p.y=this.d.y+this.u.y*this.s.y+this.v.y*this.s.x,this.p.z=this.d.z+this.u.z*this.s.y+this.v.z*this.s.x,0!=this.p.z?e.set(i.x-i.z*this.p.x/this.p.z,i.y-i.z*this.p.y/this.p.z,0):e.set(i.x-i.z*this.p.x,i.y-i.z*this.p.y,0)}toScreen(t,s,i,e){this._set||(console.error("Projection has not been set from Camera source"),this._set=!0),this.p.set(s.x-i.x,s.y-i.y,s.z-i.z),this.mm=this.p.dot(this.d),this.mm>0?(this.p.divI(this.mm),this.mm=this.p.dot(this.v)/this.tfovpoweraspect,e.x=(this.mm+1)/2*t.getWidth(),this.mm=this.p.dot(this.u)/this.tfovpower,e.y=(1-this.mm)/2*t.getHeight()):e.set(-99,-99)}}class l{constructor(){this.pos1=new h,this.uv1=new e,this.pos2=new h,this.uv2=new e,this.pos3=new h,this.uv3=new e,this.color1=new p,this.color2=new p,this.color3=new p,this.center=new h,this.normal=new h,this._cullvec=new h,this._dotvec=new h,this._depth=9999}set(t,s,i,e,h,o,r,n,a,p,c,m,l,_,d,u,g,y,x,f,v,w,b,z){return this.pos1.set(t,s,i),this.uv1.set(e,h),this.pos2.set(o,r,n),this.uv2.set(a,p),this.pos3.set(c,m,l),this.uv3.set(_,d),this.center.copy(this.pos1).add(this.pos2).add(this.pos3).divI(3),this.getnormal(),this.color1.set(u,g,y),this.color2.set(x,f,v),this.color3.set(w,b,z),this}getcenter(){return(new h).set((this.pos1.x+this.pos2.x+this.pos3.x)/3,(this.pos1.y+this.pos2.y+this.pos3.y)/3,(this.pos1.z+this.pos2.z+this.pos3.z)/3)}recalc(){return this.center.set((this.pos1.x+this.pos2.x+this.pos3.x)/3,(this.pos1.y+this.pos2.y+this.pos3.y)/3,(this.pos1.z+this.pos2.z+this.pos3.z)/3),this}getnormal(){var t,s,i,e,h,o,r,n,a,p;return t=this.pos2.x-this.pos1.x,s=this.pos2.y-this.pos1.y,i=this.pos2.z-this.pos1.z,e=this.pos3.x-this.pos1.x,h=this.pos3.y-this.pos1.y,r=s*(o=this.pos3.z-this.pos1.z)-h*i,n=i*e-o*t,a=t*h-e*s,p=Math.sqrt(r*r+n*n+a*a),this.normal.set(r/p,n/p,a/p)}clone(){return(new l).set(this.pos1.x,this.pos1.y,this.pos1.z,this.uv1.x,this.uv1.y,this.pos2.x,this.pos2.y,this.pos2.z,this.uv2.x,this.uv2.y,this.pos3.x,this.pos3.y,this.pos3.z,this.uv3.x,this.uv3.y,this.color1.r,this.color1.g,this.color1.b,this.color2.r,this.color2.g,this.color2.b,this.color3.r,this.color3.g,this.color3.b)}copy(t){return this.pos1.copy(t.pos1),this.pos2.copy(t.pos2),this.pos3.copy(t.pos3),this.color1.copy(t.color1),this.color2.copy(t.color2),this.color3.copy(t.color3),this}flipX(){return this}translate(t){return this.pos1.add(t),this.pos2.add(t),this.pos3.add(t),this}rotate(t,s,i){return this.pos1.rotX(t),this.pos2.rotX(t),this.pos3.rotX(t),this.pos1.rotY(s),this.pos2.rotY(s),this.pos3.rotY(s),this.pos1.rotZ(i),this.pos2.rotZ(i),this.pos3.rotZ(i),this}rotX(t){return this.pos1.rotX(t),this.pos2.rotX(t),this.pos3.rotX(t),this}rotY(t){return this.pos1.rotY(t),this.pos2.rotY(t),this.pos3.rotY(t),this}rotZ(t){return this.pos1.rotZ(t),this.pos2.rotZ(t),this.pos3.rotZ(t),this}scale(t){return this.pos1.mul(t),this.pos2.mul(t),this.pos3.mul(t),this}size(){var t={},s={},i={};return t.x=this.pos2.x-this.pos1.x,t.y=this.pos2.y-this.pos1.y,t.z=this.pos2.z-this.pos1.z,s.x=this.pos3.x-this.pos1.x,s.y=this.pos3.y-this.pos1.y,s.z=this.pos3.z-this.pos1.z,i.x=t.y*s.z-t.z*s.y,i.y=t.z*s.x-t.x*s.z,i.z=t.x*s.y-t.y*s.x,.5*Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z)}}class _{constructor(){this._children=[],this._bounds=[0,0,0,0,0,0],this._tmpv=new h,this._tmpr=new h,this.sortmeta={co:0,sw:0,index:0,loop:0,val:{},times:0}}clear(){return this._children=[],this._bounds=[0,0,0,0,0,0],this}clone(){let t=new _;return this._children.forEach((function(s){t._children.push(s.clone().recalc())})),t}join(t,s){var i=this;return t._children.forEach((function(t){i._children.push(t.clone().scale(s.scale).rotY(s.rotation.y).rotX(s.rotation.x).rotZ(s.rotation.z).translate(s.position).recalc())})),this}draw(t,s,i){return this._children.forEach((function(i){s.drawFace3(t,i.pos1,i.pos2,i.pos3,i.color1.toHex())})),this}scale(t){return this._children.forEach((function(s){s.scale(t)})),this}rotate(t,s,i){return this._children.forEach((function(e){e.rotate(t,s,i)})),this}drawUV(t,s,i,e,h,o){return this._children.forEach((function(r){s.drawFace(t,r,i,e,h,o)})),this}sort(t,s){for(this.sortmeta.co=0,this.sortmeta.sw=0,this.sortmeta.index=0;this.sortmeta.index<this._children.length;this.sortmeta.index++)this._children[this.sortmeta.index]._depth=this._tmpv.copy(t).sub(s.position).dist(this._tmpr.copy(this._children[this.sortmeta.index].center).mul(s.scale).rotY(s.rotation.y).rotX(s.rotation.x).rotZ(s.rotation.z));this.sortmeta.loop=!0,this.sortmeta.times=0;do{this.sortmeta.loop=!1;for(var i=0;i<this._children.length-(1+this.sortmeta.times);i++)this._children[i]._depth<this._children[i+1]._depth&&(this.sortmeta.val=this._children[i],this._children[i]=this._children[i+1],this._children[i+1]=this.sortmeta.val,this.sortmeta.loop=!0);this.sortmeta.times++}while(this.sortmeta.loop);return this}sortQ(t,s){for(this.sortmeta.co=0,this.sortmeta.sw=0,this.sortmeta.index=0;this.sortmeta.index<this._children.length;this.sortmeta.index++)this._children[this.sortmeta.index]._depth=this._tmpv.copy(t).dist(this._tmpr.copy(this._children[this.sortmeta.index].center))+this._children[this.sortmeta.index].size()/2;this.sortmeta.loop=!0,this.sortmeta.times=0;do{this.sortmeta.loop=!1;for(var i=0;i<this._children.length-(1+this.sortmeta.times);i++)this._children[i]._depth<this._children[i+1]._depth&&(this.sortmeta.val=this._children[i],this._children[i]=this._children[i+1],this._children[i+1]=this.sortmeta.val,this.sortmeta.loop=!0);this.sortmeta.times++}while(this.sortmeta.loop);return this}parsePLY(t){var s=this;c.loadFile(t,(function(t){var i={vertices:0,indeces:0},e={vertices:[],indeces:[]},h=[],o=0;h=t.split("\n"),console.log("LOADING LINES");for(var r=0;r<h.length;r++){var n=h[r].split(" ");0===o?"element"===n[0]?"vertex"===n[1]?i.vertices=parseInt(n[2],10):"face"===n[1]&&(i.indeces=parseInt(n[2],10)):"end_header"===n[0]&&(o=1):1===o?(n[0]&&(e.vertices.push(parseFloat(n[0])),e.vertices.push(parseFloat(n[1])),e.vertices.push(parseFloat(n[2])),e.vertices.push(parseFloat(n[3])),e.vertices.push(parseFloat(n[4])),e.vertices.push(parseInt(n[5],10)),e.vertices.push(parseInt(n[6],10)),e.vertices.push(parseInt(n[7],10)),s._bounds[0]=Math.min(s._bounds[0],parseFloat(n[0])),s._bounds[1]=Math.min(s._bounds[1],parseFloat(n[1])),s._bounds[2]=Math.min(s._bounds[2],parseFloat(n[2])),s._bounds[3]=Math.max(s._bounds[3],parseFloat(n[0])),s._bounds[4]=Math.max(s._bounds[4],parseFloat(n[1])),s._bounds[5]=Math.max(s._bounds[5],parseFloat(n[2]))),i.vertices--,0===i.vertices&&(o=2)):2===o&&(n[0]&&(e.indeces.push(parseInt(n[0],10)),e.indeces.push(parseInt(n[1],10)),e.indeces.push(parseInt(n[2],10)),e.indeces.push(parseInt(n[3],10))),i.indeces--,0===i.indeces&&(o=3))}for(var a=0;a<e.indeces.length;a+=4){s._children.push((new l).set(e.vertices[8*e.indeces[a+1]+0],e.vertices[8*e.indeces[a+1]+1],e.vertices[8*e.indeces[a+1]+2],e.vertices[8*e.indeces[a+1]+3],1-e.vertices[8*e.indeces[a+1]+4],e.vertices[8*e.indeces[a+2]+0],e.vertices[8*e.indeces[a+2]+1],e.vertices[8*e.indeces[a+2]+2],e.vertices[8*e.indeces[a+2]+3],1-e.vertices[8*e.indeces[a+2]+4],e.vertices[8*e.indeces[a+3]+0],e.vertices[8*e.indeces[a+3]+1],e.vertices[8*e.indeces[a+3]+2],e.vertices[8*e.indeces[a+3]+3],1-e.vertices[8*e.indeces[a+3]+4],Math.floor(e.vertices[8*e.indeces[a+1]+5]),Math.floor(e.vertices[8*e.indeces[a+1]+6]),Math.floor(e.vertices[8*e.indeces[a+1]+7]),Math.floor(e.vertices[8*e.indeces[a+2]+5]),Math.floor(e.vertices[8*e.indeces[a+2]+6]),Math.floor(e.vertices[8*e.indeces[a+2]+7]),Math.floor(e.vertices[8*e.indeces[a+3]+5]),Math.floor(e.vertices[8*e.indeces[a+3]+6]),Math.floor(e.vertices[8*e.indeces[a+3]+7])))}}));return this}}class d extends class{constructor(){this.components=[]}addComponent(t){this.components.push(t)}getComponents(){return this.components}runComponents(){let t=this;this.components.forEach((function(s){s.update(t)}))}}{constructor(t){super(),this.rand=Math.random(),this.name="Default Object",this.position=new h,this.scale=new h,this.scale.set(1,1,1),this.velocity=new h,this.game_object=null,this.decal=!1,this.mesh=null,this.depth=0,this.path=new h,this.actions=[],this.tags=[],this.bark="",this.action=null,this.timeline_index=0,this.timeline=null,this._tmp=1e9*Math.random()|0,t&&(this.bark=t.bark||"",this.action=t.action||null,this.actions=t.actions||[],this.decal=t.decal||!1,this.mesh=t.mesh,this._tmp=t._tmp,this.tags=t.tags||[],this.name=t.name,this.timeline=t.timeline||null,this.components=t.components||null,t.position&&this.position.copy(t.position),t.scale&&this.scale.copy(t.scale),t.game_object&&(this.game_object=parseInt(""+t.game_object)),t.sprite&&(this.sprite=t.sprite))}setSprite(t){this.sprite=t}getTags(){return this.tags}getSprite(){return this.sprite}getId(){return this._tmp}setNextInteraction(t){this.task_manager.setNextInteraction(t)}getBehavior(){return this.entity_behavior}getName(){return this.name}getPosition(){return this.position}getBark(){return this.bark}getScale(){return this.scale}getTimelineEvent(){return!!this.timeline&&this.timeline.getEvents()[this.timeline_index]}getTaskManager(){return this.task_manager}}const u={Math:{Vec2:e,Vec3:h,SHIPP:a},Rendering:{Surface:class{constructor(t){return this.element=t||document.createElement("canvas"),this.element.getContext&&this.element.getContext("2d")||console.error("canvas is not supported."),this._set_size=!1,this.context=this.element.getContext("2d"),this._width=this.context.width||300,this._height=this.context.height||150,this._scaling=2,this.context.font=20*this._scaling+"px DM Sans",this}drawText(t,s,i){this.context.font=20*this._scaling+"px DM Sans",this.context.fillStyle="#000",this.context.fillText(i,t,s)}resize(t,s){if("100%"==t){let s=this.getElement().parentNode;t=s.offsetWidth-(parseInt(s.style.paddingRight||"0",10)+parseInt(s.style.paddingLeft||"0",10)+parseInt(s.style.borderLeftWidth||"0",10))||1}let i=t*this._scaling,e=s*this._scaling;return e=Math.min(e,window.innerHeight*this._scaling),i=Math.min(i,window.innerWidth*this._scaling),this.element.width=i,this._width=i,this.element.height=e,this._height=e,this.context.width=i,this.context.height=e,this.element.style.width=(this._width/2|0)+"px",this.element.style.height=(this._height/2|0)+"px",this}maximize(){let t=this.getElement().parentNode;if(t){let s=t.offsetWidth-(parseInt(t.style.paddingRight||"0",10)+parseInt(t.style.paddingLeft||"0",10)+parseInt(t.style.borderLeftWidth||"0",10))||1,i=t.offsetHeight||this.getHeight()||1;this._width===s*this._scaling&&this._height===i*this._scaling||this.resize(s,i)}}setSize(t,s){this._set_size=!0,this.resize(t,s)}attach(t,s){return document.body.appendChild(this.element),this.element.style.position="fixed",this.element.style.left=t+"px",this.element.style.top=s+"px",this}detach(){this.element.parentElement.removeChild(this.element)}fill(t){return this._set_size||this.maximize(),this.context.beginPath(),this.context.fillStyle=t,this.context.rect(0,0,this._width,this._height),this.context.fill(),this}clear(){return this.context.clearRect(0,0,this._width,this._height),this}getElement(){return this.element}getContext(){return this.context}getScaling(){return this._scaling}getWidth(){return this._width}getHeight(){return this._height}getPerceptualWidth(){return this._width/this._scaling}getPerceptualHeight(){return this._height/this._scaling}},Sprite:n,Camera:class{constructor(){this.from=(new h).set(0,100,30),this.to=new h,this.up=(new h).set(0,0,1),this.tmpv=new h,this.fov=45,this.zoom=1,this.aspect=1,this.projection=new m,this.animation={active:!1,startfrom:new h,startto:new h,pos:0,gain:.5,speed:1,finishfrom:new h,finishto:new h},this._tmp={v1:new h,v2:new h,v3:new h,v4:new h,p1:new e,p2:new e,p3:new e,drawntris:0,culltris:0,_t:[],from_camera_scale_x:0,from_camera_scale_y:0,sr:0,sh:0,sc:0,vx:0,vy:0,lightingvec:0}}getProjection(){return this.projection}animate(t,s,i,e,h,o){this.animation.active=!0,this.animation.startfrom.copy(t),this.animation.finishfrom.copy(s),this.animation.startto.copy(i),this.animation.finishto.copy(e),this.animation.gain=o,this.animation.pos=0,this.animation.speed=h}update(){}drawActor(t,s){let i=Date.now()/16;if(this.projection.toScreen(t,s.position,this.from,this._tmp.p1),this._tmp.v2.copy(this.from).z=0,this._tmp.v1.copy(s.position).pointTo(this._tmp.v2),this._tmp.v1.rotZ(90).add(s.position),this.projection.toScreen(t,this._tmp.v1,this.from,this._tmp.p2),this._tmp.from_camera_scale_x=this._tmp.p2.dist(this._tmp.p1)/24,this._tmp.from_camera_scale_y=this._tmp.from_camera_scale_x,this._tmp.sr=Math.sin(i/6+s.rand)*(500*Math.pow(s.velocity.mag(),2))*1.5,this._tmp.sh=1,this._tmp.sc=s.scale.x||1,this._tmp.vx=this._tmp.p1.x-s.getSprite().getImage().width/2*this._tmp.from_camera_scale_x*this._tmp.sc,this._tmp.vy=this._tmp.p1.y-s.getSprite().getImage().height*this._tmp.from_camera_scale_y*this._tmp.sc-this._tmp.sh-(1+Math.sin(i/3))*Math.pow(s.velocity.mag(),2)*500.5*(this._tmp.from_camera_scale_x/2),this._tmp.p1.x-s.getSprite().getImage().width*this._tmp.from_camera_scale_x*this._tmp.sc/2>t.getWidth()||this._tmp.p1.x+s.getSprite().getImage().width*this._tmp.from_camera_scale_x*this._tmp.sc/2<0||this._tmp.p1.y<0||this._tmp.p1.y-s.getSprite().getImage().height*this._tmp.from_camera_scale_y*this._tmp.sc>t.getHeight())return!1;if(t.getContext().save(),t.getContext().translate(.5+this._tmp.vx+s.getSprite().getImage().width*this._tmp.from_camera_scale_x*this._tmp.sc/2,.5+this._tmp.vy+s.getSprite().getImage().height*this._tmp.from_camera_scale_y*this._tmp.sc/2),t.getContext().rotate(this._tmp.sr),t.getContext().drawImage(s.getSprite().getImage(),.5-s.getSprite().getImage().width*this._tmp.sc*this._tmp.from_camera_scale_x/2,-(.5+s.getSprite().getImage().height*this._tmp.sc*this._tmp.from_camera_scale_y/2),s.getSprite().getImage().width*this._tmp.from_camera_scale_x*this._tmp.sc,s.getSprite().getImage().height*this._tmp.from_camera_scale_y*this._tmp.sc),t.getContext().fillStyle="#fff",-1!==s.tags.indexOf("npc")){let t=[];if(s.getTaskManager().getCurrentTasks().forEach((function(s){t.push(s.getName())})),s.getTaskManager().getCurrentTasks().length){s.getTaskManager().getCurrentTasks()[0].getName(),s.getTaskManager().getCurrentTasks()[0].events[0].type}}s.bark&&t.drawText(0,-40,s.bark),t.getContext().restore()}drawFace3(t,s,i,e,h){var o,r,n,a,p,c,m,l,_;this.projection.toScreen(t,s,this.from,this._tmp.p1),this.projection.toScreen(t,i,this.from,this._tmp.p2),this.projection.toScreen(t,e,this.from,this._tmp.p3),o=i.x-s.x,r=i.y-s.y,n=i.z-s.z,a=e.x-s.x,p=e.y-s.y,m=r*(c=e.z-s.z)-p*n,l=n*a-c*o,_=o*p-a*r,Math.sqrt(m*m+l*l+_*_),t.getContext().fillStyle=h||"#000",t.getContext().beginPath(),t.getContext().moveTo(this._tmp.p1.x,this._tmp.p1.y),t.getContext().lineTo(this._tmp.p2.x,this._tmp.p2.y),t.getContext().lineTo(this._tmp.p3.x,this._tmp.p3.y),t.getContext().fill(),t.getContext().strokeStyle=h||"#f00",t.getContext().stroke()}drawFace(t,s,i,o,r,n=9){if(s.getcenter().dist(this.from)<Math.pow(1.8,n-1)&&n>=1){let a=n-1,p=(new h).copy(s.pos1),c=(new h).copy(s.pos2),m=(new h).copy(s.pos3),_=(new h).add(p).add(c).divI(2),d=(new h).add(c).add(m).divI(2),u=(new h).add(m).add(p).divI(2),g=(new e).copy(s.uv1),y=(new e).copy(s.uv2),x=(new e).copy(s.uv3),f=(new e).add(g).add(y).divI(2),v=(new e).add(y).add(x).divI(2),w=(new e).add(x).add(g).divI(2),b=s.color1,z=new l;z.pos1.copy(m),z.pos2.copy(u),z.pos3.copy(d),z.uv1.copy(x),z.uv2.copy(w),z.uv3.copy(v),z.color1=b,z.color2=b,z.color3=b,this.drawFace(t,z,i,o,r,a);let M=new l;M.pos1.copy(d),M.pos2.copy(_),M.pos3.copy(c),M.uv1.copy(v),M.uv2.copy(f),M.uv3.copy(y),M.color1=b,M.color2=b,M.color3=b,this.drawFace(t,M,i,o,r,a);let I=new l;I.pos1.copy(u),I.pos2.copy(p),I.pos3.copy(_),I.uv1.copy(w),I.uv2.copy(g),I.uv3.copy(f),I.color1=b,I.color2=b,I.color3=b,this.drawFace(t,I,i,o,r,a);let j=new l;return j.pos1.copy(u),j.pos2.copy(d),j.pos3.copy(_),j.uv1.copy(w),j.uv2.copy(v),j.uv3.copy(f),j.color1=b,j.color2=b,j.color3=b,this.drawFace(t,j,i,o,r,a),!1}if(this.projection.toScreen(t,this._tmp.v1.copy(i.position).divI(1).add(this._tmp.v4.copy(s.pos1).mulI(r)),this.from,this._tmp.p1),this.projection.toScreen(t,this._tmp.v2.copy(i.position).divI(1).add(this._tmp.v4.copy(s.pos2).mulI(r)),this.from,this._tmp.p2),this.projection.toScreen(t,this._tmp.v3.copy(i.position).divI(1).add(this._tmp.v4.copy(s.pos3).mulI(r)),this.from,this._tmp.p3),function(t,s,i,h){var o=new e;o.x=(t.x+s.x+i.x)/3,o.y=(t.y+s.y+i.y)/3;var r=new e;t.sub(r.copy(o).pointTo(t).mulI(h)),s.sub(r.copy(o).pointTo(s).mulI(h)),i.sub(r.copy(o).pointTo(i).mulI(h))}(this._tmp.p1,this._tmp.p2,this._tmp.p3,.45),t.getContext().beginPath(),t.getContext().moveTo(.5+this._tmp.p1.x,.5+this._tmp.p1.y),t.getContext().lineTo(.5+this._tmp.p2.x,.5+this._tmp.p2.y),t.getContext().lineTo(.5+this._tmp.p3.x,.5+this._tmp.p3.y),this._tmp._t[20]=0,this._tmp._t[21]=0,this._tmp._t[22]=o.width,this._tmp._t[23]=o.height,this._tmp._t[8]=this._tmp.p1.x,this._tmp._t[9]=this._tmp.p1.y,this._tmp._t[10]=this._tmp.p2.x,this._tmp._t[11]=this._tmp.p2.y,this._tmp._t[12]=this._tmp.p3.x,this._tmp._t[13]=this._tmp.p3.y,this._tmp._t[14]=(s.uv1.x+this._tmp._t[20])*this._tmp._t[22],this._tmp._t[15]=(s.uv1.y+this._tmp._t[21])*this._tmp._t[23],this._tmp._t[16]=(s.uv2.x+this._tmp._t[20])*this._tmp._t[22],this._tmp._t[17]=(s.uv2.y+this._tmp._t[21])*this._tmp._t[23],this._tmp._t[18]=(s.uv3.x+this._tmp._t[20])*this._tmp._t[22],this._tmp._t[19]=(s.uv3.y+this._tmp._t[21])*this._tmp._t[23],this._tmp._t[10]-=this._tmp._t[8],this._tmp._t[11]-=this._tmp._t[9],this._tmp._t[12]-=this._tmp._t[8],this._tmp._t[13]-=this._tmp._t[9],this._tmp._t[16]-=this._tmp._t[14],this._tmp._t[17]-=this._tmp._t[15],this._tmp._t[18]-=this._tmp._t[14],this._tmp._t[19]-=this._tmp._t[15],this._tmp._t[6]=this._tmp._t[16]*this._tmp._t[19]-this._tmp._t[18]*this._tmp._t[17],0===this._tmp._t[6])return!1;this._tmp._t[7]=1/this._tmp._t[6],this._tmp._t[0]=(this._tmp._t[19]*this._tmp._t[10]-this._tmp._t[17]*this._tmp._t[12])*this._tmp._t[7],this._tmp._t[1]=(this._tmp._t[19]*this._tmp._t[11]-this._tmp._t[17]*this._tmp._t[13])*this._tmp._t[7],this._tmp._t[2]=(this._tmp._t[16]*this._tmp._t[12]-this._tmp._t[18]*this._tmp._t[10])*this._tmp._t[7],this._tmp._t[3]=(this._tmp._t[16]*this._tmp._t[13]-this._tmp._t[18]*this._tmp._t[11])*this._tmp._t[7],this._tmp._t[4]=this._tmp._t[8]-this._tmp._t[0]*this._tmp._t[14]-this._tmp._t[2]*this._tmp._t[15],this._tmp._t[5]=this._tmp._t[9]-this._tmp._t[1]*this._tmp._t[14]-this._tmp._t[3]*this._tmp._t[15],t.getContext().save(),t.getContext().clip(),t.getContext().transform(this._tmp._t[0],this._tmp._t[1],this._tmp._t[2],this._tmp._t[3],this._tmp._t[4],this._tmp._t[5]),t.getContext().drawImage(o,0,0),t.getContext().restore()}},Projection:m,Mesh:_,Face3:l,Room:class{constructor(t){let s=this;this.name="Default Room",this.objects=[],this.position=new h,this.size=new h,this.size.x=24,this.size.y=16,t&&(this.name=t.name,this.position.copy(t.position),this.size.copy(t.size),t.objects.forEach((function(t){s.objects.push(new d(t))})))}getName(){return this.name}setName(t){this.name=t}getObjects(){return this.objects}addObject(t){this.objects.push(t)}createObject(t){this.objects.push(new d(t))}findItems(t){let s=[];return this.objects.forEach((function(i){-1!==i.getTags().indexOf(t)&&s.push(i)})),s}depthSort(t){let s=new h;s.copy(t.from);for(var i=0;i<this.objects.length;i++)this.objects[i].depth=s.dist(this.objects[i].position),this.objects[i].decal&&(this.objects[i].depth+=1e6,this.objects[i].depth+=this.objects[i].scale.mag());var e=!0;do{e=!1;for(var o=0;o<this.objects.length-1;o++)if(this.objects[o].depth<this.objects[o+1].depth){var r;r=this.objects[o],this.objects[o]=this.objects[o+1],this.objects[o+1]=r,e=!0}0}while(e)}update(){}},RoomObject:d},Color:{RGB:p,RGBA:class{constructor(){this.r=0,this.g=0,this.b=0,this.a=1,this.set=(t,s,i,e)=>(this.r=t,this.g=s,this.b=i,this.a=e,this),this.copy=t=>(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this),this.hexToColor=(t,s)=>(t=t.replace("#",""),this.r=parseInt(t.substring(0,2),16),this.g=parseInt(t.substring(2,4),16),this.b=parseInt(t.substring(4,6),16),this.a=255*(s||1)|0,this)}}},Utils:{AssetLoader:c,Object:{rollup:function(t){for(var s in t)if("object"==typeof t[s]){for(var i in t[s])t[i]=t[s][i];delete t[s]}return t}},Array:{max:function(t){let s;return t.forEach((function(t){(!s||t>s)&&(s=t)})),s},normalizeProperties(t,s=2){let i=[],e=[];return t.forEach((function(t){for(var s in t)i[s]||(i[s]=[]),i[s].push(t[s])})),t.forEach((function(t){let h={};for(var o in t)isNaN(t[o])?h[o]=t[o]:h[o]=(t[o]/window.Oak.Utils.Array.max(i[o])).toFixed(s);e.push(h)})),e}},HTML:{arrayToTable(t,s){let i=[],e=void 0!==(s=s||{}).headers?s.headers:[];return e&&t.forEach((function(t){(function(t){let s=[];for(var i in t)s.push(i);return s})(t).forEach((function(t){-1==e.indexOf(t)&&e.push(t)}))})),i.push(`<table class='${s.class||""}'>`),e.length?(i.push("<tr>"),e.forEach((function(t){i.push("<td><strong><em>"),i.push(t),i.push("</em></strong></td>")})),i.push("</tr>"),t.forEach((function(t){i.push("<tr>"),e.forEach((function(s){i.push("<td>"),i.push("number"==typeof t[s]?t[s].toFixed(2):t[s]),i.push("</td>")})),i.push("</tr>")}))):t.forEach((function(t){i.push("<tr>"),i.push("<td>"),i.push("number"==typeof t?t.toFixed(void 0!==s.toFixed?s.toFixed:2):t),i.push("</td>"),i.push("</tr>")})),i.push("</table>"),i.join("")}}}};window.Oak=u}]);